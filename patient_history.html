<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>My History — Divine Clinic</title>
<link rel="stylesheet" href="shared.css">
<script src="api.js"></script>
</head>
<body>
<div class="header">Divine Clinic — Patient History</div>
<div class="container">
  <h2>Your Records</h2>
  <label>Patient ID</label>
  <input id="pid" placeholder="Paste patient id (or use saved)">
  <button id="loadBtn">Load History</button>
  <div id="history" class="card" style="display:none;"></div>
</div>
<script>
document.getElementById('pid').value = localStorage.getItem('last_patient_id') || '';
document.getElementById('loadBtn').addEventListener('click', async ()=>{
  const pid = document.getElementById('pid').value.trim();
  if(!pid) return alert('Enter patient id');
  try {
    const visits = await api('/api/patients/' + pid + '/history');
    const box = document.getElementById('history');
    box.style.display = 'block'; box.innerHTML = '<h3>Visits</h3>';
    if(!visits.length) box.innerHTML += '<p class="small'>No visits yet.</p>';
    for(const v of visits){
      const div = document.createElement('div'); div.className='token_item';
      let html = `<div><b>${v.visit_date}</b><br>${v.reason || ''}<br>${v.notes || ''}</div>`;
      if(v.medicines && v.medicines.length){
        html += '<div style="text-align:right"><b>Medicines</b><br>';
        for(const m of v.medicines) html += `<div class="small">${m.medicine_name} — ${m.dosage} — ${m.duration_days} days</div>`;
        html += '</div>';
      }
      div.innerHTML = html; box.appendChild(div);
    }
  } catch(e){ alert('Failed: ' + e.message); }
});
</script>
</body>
</html>
